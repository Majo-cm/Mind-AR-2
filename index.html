<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Panader√≠a AR</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #6a3093, #a044ff);
            height: 100vh;
        }
        
        #hud-text {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
            z-index: 9999;
            text-align: center;
            width: 90%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #3a1c71, #d76d77, #ffaf7b);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffcc00;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 25px;
        }
        
        .loading-text {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .loading-subtext {
            font-size: 16px;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
        }
        
        .button-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 9999;
        }
        
        .change-button {
            padding: 12px 20px;
            background: rgba(255, 204, 0, 0.9);
            color: #333;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            min-width: 160px;
            text-align: center;
        }
        
        .change-button:active {
            transform: scale(0.95);
            background: rgba(255, 230, 0, 0.9);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            #hud-text {
                font-size: 16px;
                padding: 10px;
            }
            
            .loading-text {
                font-size: 20px;
            }
            
            .loading-subtext {
                font-size: 14px;
            }
            
            .change-button {
                font-size: 14px;
                padding: 10px 16px;
                min-width: 140px;
            }
        }
        
        @media (max-width: 480px) {
            #hud-text {
                font-size: 14px;
                top: 10px;
            }
            
            .loading-text {
                font-size: 18px;
            }
            
            .button-container {
                flex-direction: column;
                gap: 10px;
                bottom: 10px;
            }
            
            .change-button {
                font-size: 13px;
                padding: 12px 14px;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div id="hud-text">üçû Bienvenido a la Panader√≠a AR ü•ê<br>Usa los botones para cambiar entre diferentes tipos de pan</div>
    
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Cargando Experiencia de Realidad Aumentada</div>
        <div class="loading-subtext">Por favor, apunta tu c√°mara a los marcadores de panader√≠a cuando se te solicite</div>
    </div>

    <div class="button-container">
        <button class="change-button" id="change-croissant">Cambiar Pan Dulce</button>
        <button class="change-button" id="change-baguette">Cambiar Pan Salado</button>
    </div>

    <a-scene
        mindar-image="imageTargetSrc: https://raw.githubusercontent.com/Majo-cm/Mind-AR-2/main/targets%20(4).mind; maxTrack: 2"
        color-space="sRGB"
        renderer="colorManagement: true, physicallyCorrectLights"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false"
    >
        <!-- C√°mara -->
        <a-camera 
            position="0 0 0" 
            look-controls="enabled: false">
        </a-camera>

        <!-- Target 0: Croissant -->
        <a-entity mindar-image-target="targetIndex: 0">
            <a-text 
                id="croissant-text"
                value="Croissant" 
                align="center" 
                color="yellow" 
                position="0 0.5 0" 
                scale="1.5 1.5 1.5"
                width="3">
            </a-text>
            
            <a-entity
                id="croissant"
                rotation="0 0 0"
                position="0 -0.25 0"
                scale="1.2 1.2 1.2">
                <a-gltf-model
                    src="https://raw.githubusercontent.com/Majo-cm/Mind-AR-2/main/Croissant.glb"
                    animation-mixer="loop: repeat"
                ></a-gltf-model>
            </a-entity>
        </a-entity>

        <!-- Target 1: Baguette -->
        <a-entity mindar-image-target="targetIndex: 1">
            <a-text 
                id="baguette-text"
                value="Baguette" 
                align="center" 
                color="orange" 
                position="0 0.5 0" 
                scale="1.5 1.5 1.5"
                width="3">
            </a-text>
            
            <a-entity
                id="baguette"
                rotation="0 0 0"
                position="0 -0.25 0"
                scale="1.2 1.2 1.2">
                <a-gltf-model
                    src="https://raw.githubusercontent.com/Majo-cm/Mind-AR-2/main/Loaf%20Baguette.glb"
                    animation-mixer="loop: repeat"
                ></a-gltf-model>
            </a-entity>
        </a-entity>
        
        <!-- Luz ambiental -->
        <a-light type="ambient" color="#FFF" intensity="0.7"></a-light>
        <a-light type="directional" color="#FFF" intensity="0.5" position="2 5 5"></a-light>
        
        <!-- Efecto de ambiente -->
        <a-entity environment="preset: default; groundColor: #445; grid: none"></a-entity>
    </a-scene>

    <script>
        // URLs de los modelos
        const croissantModels = [
            "https://raw.githubusercontent.com/Majo-cm/Mind-AR-2/main/Croissant.glb",
            "https://raw.githubusercontent.com/Majo-cm/Mind-AR-2/main/Donut.glb"
        ];
        
        const baguetteModels = [
            "https://raw.githubusercontent.com/Majo-cm/Mind-AR-2/main/Loaf%20Baguette.glb",
            "https://raw.githubusercontent.com/Majo-cm/Mind-AR-2/main/Bread.glb"
        ];

        // Nombres para mostrar seg√∫n el modelo actual
        const croissantNames = ["Croissant", "Dona"];
        const baguetteNames = ["Baguette", "Pan Blanco"];
        
        let croissantIndex = 0;
        let baguetteIndex = 0;
        
        // Esperar a que A-Frame est√© completamente cargado
        window.addEventListener('load', function() {
            const scene = document.querySelector('a-scene');
            
            // Ocultar pantalla de carga cuando la escena est√© lista
            if (scene.hasLoaded) {
                hideLoading();
            } else {
                scene.addEventListener('loaded', hideLoading);
            }
            
            // Configurar event listeners despu√©s de que todo est√© cargado
            scene.addEventListener('loaded', function() {
                setTimeout(setupEventListeners, 1000);
            });
        });
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        function setupEventListeners() {
            const changeCroissantBtn = document.getElementById("change-croissant");
            const changeBaguetteBtn = document.getElementById("change-baguette");
            
            if (changeCroissantBtn) {
                // Para dispositivos t√°ctiles
                changeCroissantBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    changeModel('croissant');
                });
                
                // Para dispositivos con mouse
                changeCroissantBtn.addEventListener('click', function() {
                    changeModel('croissant');
                });
            }
            
            if (changeBaguetteBtn) {
                // Para dispositivos t√°ctiles
                changeBaguetteBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    changeModel('baguette');
                });
                
                // Para dispositivos con mouse
                changeBaguetteBtn.addEventListener('click', function() {
                    changeModel('baguette');
                });
            }
            
            // A√±adir vibraci√≥n en dispositivos m√≥viles si est√° disponible
            if ('vibrate' in navigator) {
                document.querySelectorAll('.change-button').forEach(button => {
                    button.addEventListener('touchstart', function() {
                        navigator.vibrate(10);
                    });
                });
            }
        }
        
        function changeModel(type) {
            let element, models, currentIndex, textElement, names;
            
            if (type === 'croissant') {
                element = document.querySelector("#croissant");
                models = croissantModels;
                currentIndex = croissantIndex;
                textElement = document.querySelector("#croissant-text");
                names = croissantNames;
            } else {
                element = document.querySelector("#baguette");
                models = baguetteModels;
                currentIndex = baguetteIndex;
                textElement = document.querySelector("#baguette-text");
                names = baguetteNames;
            }
            
            if (!element) return;
            
            const gltfModel = element.querySelector('a-gltf-model');
            if (!gltfModel) return;
            
            // A√±adir animaci√≥n de escala al cambiar modelo
            element.setAttribute('animation', {
                property: 'scale',
                to: '1.5 1.5 1.5',
                dur: 200,
                easing: 'easeOutElastic',
                loop: 0
            });
            
            setTimeout(() => {
                if (type === 'croissant') {
                    croissantIndex = (croissantIndex + 1) % models.length;
                    gltfModel.setAttribute('src', models[croissantIndex]);
                    
                    // Cambiar el texto seg√∫n el modelo actual
                    if (textElement) {
                        textElement.setAttribute('value', names[croissantIndex]);
                    }
                    
                    console.log("Croissant cambiado a:", models[croissantIndex]);
                } else {
                    baguetteIndex = (baguetteIndex + 1) % models.length;
                    gltfModel.setAttribute('src', models[baguetteIndex]);
                    
                    // Cambiar el texto seg√∫n el modelo actual
                    if (textElement) {
                        textElement.setAttribute('value', names[baguetteIndex]);
                    }
                    
                    // Ajustar la escala para el modelo de bread (mitad del tama√±o)
                    if (baguetteIndex === 1) {
                        element.setAttribute('scale', '0.6 0.6 0.6');
                    } else {
                        element.setAttribute('scale', '1.2 1.2 1.2');
                    }
                    
                    console.log("Baguette cambiado a:", models[baguetteIndex]);
                }
                
                // Restaurar escala original (excepto para bread)
                if (!(type === 'baguette' && baguetteIndex === 1)) {
                    element.setAttribute('animation', {
                        property: 'scale',
                        to: '1.2 1.2 1.2',
                        dur: 300,
                        easing: 'easeOutElastic',
                        loop: 0
                    });
                }
            }, 200);
        }
    </script>
</body>
</html>
